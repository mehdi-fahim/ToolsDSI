{% extends 'admin/base.html.twig' %}

{% block title %}Utilisateurs Sowell{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto;">
    <h1 style="font-size: 1.8rem; margin-bottom: 16px;">Utilisateurs Sowell</h1>

    {% if error %}
        <div style="background: #FEE2E2; color: #991B1B; padding: 12px 16px; border-radius: 6px; margin-bottom: 16px;">{{ error }}</div>
    {% endif %}
    {% if success %}
        <div style="background: #DEF7EC; color: #03543F; padding: 12px 16px; border-radius: 6px; margin-bottom: 16px;">{{ success }}</div>
    {% endif %}

    <div style="background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; padding: 16px; margin-bottom: 24px;">
        <h2 style="font-size: 1.2rem; margin-bottom: 12px;">Ajouter un utilisateur (renseigner email dans TOZD2)</h2>
        <form method="post">
            <input type="hidden" name="action" value="add_user" />
            <div style="display: grid; grid-template-columns: 1fr; gap: 12px;">
                <div>
                    <label for="email" style="display:block; font-weight: 600; margin-bottom: 6px;">Email</label>
                    <input type="email" id="email" name="email" class="input" style="width:100%; padding: 10px 12px; border:1px solid #d1d5db; border-radius: 8px;" required />
                </div>
            </div>
            <div style="margin-top: 12px;">
                <button type="submit" class="btn" style="padding: 10px 16px; border-radius: 8px;">Ajouter</button>
            </div>
        </form>
    </div>

    <div style="background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; padding: 16px;">
        <h2 style="font-size: 1.2rem; margin-bottom: 12px;">Liste des utilisateurs</h2>
        <div style="overflow-x:auto;">
            <table style="width:100%; border-collapse: collapse;">
                <thead>
                    <tr style="background:#f9fafb; text-align:left;">
                        <th style="padding:10px; border-bottom:1px solid #e5e7eb;">Nom</th>
                        <th style="padding:10px; border-bottom:1px solid #e5e7eb;">Prénom</th>
                        <th style="padding:10px; border-bottom:1px solid #e5e7eb;">Code</th>
                        <th style="padding:10px; border-bottom:1px solid #e5e7eb;">Email</th>
                        <th style="padding:10px; border-bottom:1px solid #e5e7eb; width:1%; white-space:nowrap;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                {% if users is empty %}
                    <tr>
                        <td colspan="5" style="padding:12px; text-align:center; color:#6b7280;">Aucun utilisateur</td>
                    </tr>
                {% else %}
                    {% for u in users %}
                    <tr>
                        <td style="padding:10px; border-bottom:1px solid #f3f4f6;">{{ u.LAST_NAME }}</td>
                        <td style="padding:10px; border-bottom:1px solid #f3f4f6;">{{ u.FIRST_NAME }}</td>
                        <td style="padding:10px; border-bottom:1px solid #f3f4f6;">{{ u.CODE }}</td>
                        <td style="padding:10px; border-bottom:1px solid #f3f4f6;">{{ u.EMAIL }}</td>
                        <td style="padding:10px; border-bottom:1px solid #f3f4f6;">
                            <form method="post" style="display:inline;" onsubmit="return confirm('Supprimer cet accès Sowell ?');">
                                <input type="hidden" name="action" value="delete_user" />
                                <input type="hidden" name="email_to_delete" value="{{ u.EMAIL }}" />
                                <button type="submit" class="btn btn-danger" style="padding: 6px 12px; border-radius: 6px;">Supprimer</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                {% endif %}
                </tbody>
            </table>
        </div>
        {% if pagination is defined and pagination.totalPages > 1 %}
        <div class="pagination" style="display:flex; gap:8px; justify-content:center; margin-top:12px;">
            {% set current = pagination.page %}
            {% for p in 1..pagination.totalPages %}
                {% if p == current %}
                    <span class="current">{{ p }}</span>
                {% else %}
                    <a href="{{ path('admin_sowell_users', {page: p}) }}">{{ p }}</a>
                {% endif %}
            {% endfor %}
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}


