{% extends 'admin/base.html.twig' %}

{% block title %}Historique des actions{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto; display: flex; flex-direction: column; gap: 16px;">
  <div style="background:#fff;border-radius:15px;box-shadow:0 8px 32px rgba(0,0,0,0.08);border:1px solid #eef2f7;padding:20px;">
    <h1 style="font-size:1.4rem;color:#232946;font-weight:700;margin-bottom:12px;">Historique des actions</h1>
    <form method="get" action="{{ path('admin_history') }}" style="display:grid;grid-template-columns:repeat(7,1fr);gap:10px;align-items:end;">
      <div>
        <label style="font-weight:600;color:#232946;font-size:0.9rem;">Utilisateur</label>
        <input type="text" name="user_id" value="{{ filters.user_id }}" placeholder="ex: JDUPONT" style="width:100%;padding:10px 12px;border:1.5px solid #e2e8f0;border-radius:8px;background:#f7fafc;">
      </div>
      <div>
        <label style="font-weight:600;color:#232946;font-size:0.9rem;">Action</label>
        <input type="text" name="action" value="{{ filters.action }}" placeholder="ex: création, suppression, update, consultation" style="width:100%;padding:10px 12px;border:1.5px solid #e2e8f0;border-radius:8px;background:#f7fafc;">
      </div>
      <div>
        <label style="font-weight:600;color:#232946;font-size:0.9rem;">IP</label>
        <input type="text" name="ip" value="{{ filters.ip }}" placeholder="ex: 192.168.0.10" style="width:100%;padding:10px 12px;border:1.5px solid #e2e8f0;border-radius:8px;background:#f7fafc;">
      </div>
      <div>
        <label style="font-weight:600;color:#232946;font-size:0.9rem;">Du</label>
        <input type="date" name="from" value="{{ filters.from }}" style="width:100%;padding:10px 12px;border:1.5px solid #e2e8f0;border-radius:8px;background:#f7fafc;">
      </div>
      <div>
        <label style="font-weight:600;color:#232946;font-size:0.9rem;">Au</label>
        <input type="date" name="to" value="{{ filters.to }}" style="width:100%;padding:10px 12px;border:1.5px solid #e2e8f0;border-radius:8px;background:#f7fafc;">
      </div>
      <div>
        <label style="font-weight:600;color:#232946;font-size:0.9rem;">Limite</label>
        <input type="number" min="1" max="1000" name="limit" value="{{ filters.limit|default(200) }}" style="width:100%;padding:10px 12px;border:1.5px solid #e2e8f0;border-radius:8px;background:#f7fafc;">
      </div>
      <div>
        <label style="font-weight:600;color:#232946;font-size:0.9rem;">Page</label>
        <input type="number" min="1" name="page" value="{{ filters.page|default(1) }}" style="width:100%;padding:10px 12px;border:1.5px solid #e2e8f0;border-radius:8px;background:#f7fafc;">
      </div>
      <div style="grid-column: 1 / -1; display:flex; gap:10px;">
        <button type="submit" class="btn">Rechercher</button>
        <a href="{{ path('admin_history') }}" class="btn btn-secondary">Réinitialiser</a>
      </div>
    </form>
  </div>

  <div style="background:#fff;border-radius:15px;box-shadow:0 8px 32px rgba(0,0,0,0.08);border:1px solid #eef2f7;padding:16px;">
    <div class="table-container">
      <table class="admin-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Utilisateur</th>
            <th>Action</th>
            <th>Route / Entité</th>
            <th>IP</th>
          </tr>
        </thead>
        <tbody>
          {% for e in entries %}
            {% set action = (e.action ?? '')|lower %}
            {% set badgeBg = action == 'create' ? '#10b981' : (action == 'update' ? '#f59e0b' : (action == 'delete' ? '#ef4444' : '#3b82f6')) %}
            <tr>
              <td>{{ e.timestamp }}</td>
              <td>{{ e.user_id ?? '-' }}</td>
              <td>
                <span style="display:inline-block;padding:4px 8px;border-radius:999px;color:#fff;background: {{ badgeBg }};font-size:12px;text-transform:uppercase;">
                  {{ action ?: 'view' }}
                </span>
              </td>
              <td>
                <div style="display:flex;flex-direction:column;gap:2px;">
                  <span style="color:#111827;">{{ e.route ?? '-' }}</span>
                  {% if e.entity %}<span style="color:#6b7280;font-size:12px;">{{ e.entity }}{% if e.entity_id %} #{{ e.entity_id }}{% endif %}</span>{% endif %}
                </div>
              </td>
              <td>{{ e.ip ?? '-' }}</td>
            </tr>
          {% else %}
            <tr><td colspan="5" style="text-align:center;color:#6b7280;">Aucun résultat</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px;color:#6b7280;">
      <div>Page {{ filters.page }}/{{ filters.totalPages }} — {{ filters.total }} résultat(s)</div>
      <div style="display:flex;gap:8px;">
        {% set p = filters.page|default(1) %}
        {% set prev = p > 1 ? p - 1 : 1 %}
        {% set next = p < filters.totalPages ? p + 1 : filters.totalPages %}
        <a class="btn btn-secondary" href="{{ path('admin_history', filters|merge({'page': prev})) }}">Précédent</a>
        <a class="btn" href="{{ path('admin_history', filters|merge({'page': next})) }}">Suivant</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}


