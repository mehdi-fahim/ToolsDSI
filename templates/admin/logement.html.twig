{% extends 'admin/base.html.twig' %}

{% block title %}Logement{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1>Gestion Logement</h1>
        <p>Recherche et mise à jour d'une demande.</p>
    </div>

    {% if error %}
        <div style="background:#fed7d7;color:#c53030;padding:12px 16px;border-radius:8px;margin-bottom:16px;">{{ error }}</div>
    {% endif %}
    {% if success %}
        <div style="background:#c6f6d5;color:#22543d;padding:12px 16px;border-radius:8px;margin-bottom:16px;">{{ success }}</div>
    {% endif %}

    <div class="admin-content">
        <form method="post" style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:18px;">
            <label for="numero_demande">Demande n°</label>
            <input type="text" id="numero_demande" name="numero_demande" value="{{ numeroDemande }}" class="search-input" style="max-width:220px;">
            <button name="action" value="search" class="btn">Chercher</button>
        </form>

        <div style="display:grid;gap:24px;">
            <div>
                <h3 style="margin-bottom:8px;">Changer le statut d'une demande</h3>
                {% if data.demande %}
                    <div style="background:#f7fafc;padding:12px;border-radius:6px;margin-bottom:12px;border-left:4px solid #4299e1;">
                        <strong>Statut actuel :</strong> 
                        {% if etat == 'N' %}N - Annuler
                        {% elseif etat == 'P' %}P - Périmée
                        {% elseif etat == 'E' %}E - Prop. en cours
                        {% elseif etat == 'A' %}A - Saisie
                        {% elseif etat == 'I' %}I - Satisfaite
                        {% else %}{{ etat }}
                        {% endif %}
                    </div>
                {% endif %}
                <form method="post" style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;">
                    <input type="hidden" name="numero_demande" value="{{ numeroDemande }}">
                    <label for="etat">Mettre au statut</label>
                    <select id="etat" name="etat" style="padding:8px 12px;border:1px solid #e2e8f0;border-radius:6px;min-width:200px;">
                        <option value="">Sélectionner un statut</option>
                        <option value="N" {{ etat == 'N' ? 'selected' : '' }}>N - Annuler</option>
                        <option value="P" {{ etat == 'P' ? 'selected' : '' }}>P - Périmée</option>
                        <option value="E" {{ etat == 'E' ? 'selected' : '' }}>E - Prop. en cours</option>
                        <option value="A" {{ etat == 'A' ? 'selected' : '' }}>A - Saisie</option>
                        <option value="I" {{ etat == 'I' ? 'selected' : '' }}>I - Satisfaite</option>
                    </select>
                    <button class="btn" name="action" value="update_etat">Modifier</button>
                </form>
            </div>

            <div>
                <h3 style="margin-bottom:8px;">Modifier les candidats</h3>
                <div style="display:grid;gap:14px;">
                    <form method="post" style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
                        <input type="hidden" name="numero_demande" value="{{ numeroDemande }}">
                        <span>Demandeur :</span>
                        <input type="text" name="demandeur_tiers" value="{{ data.demandeur.tiers }}" placeholder="Tiers" style="width:120px;padding:8px 10px;border:1px solid #e2e8f0;border-radius:6px;">
                        <span>Date Début</span>
                        <input type="text" name="demandeur_debut" value="{{ data.demandeur.debut }}" style="width:140px;padding:8px 10px;border:1px solid #e2e8f0;border-radius:6px;">
                        <span>Date Fin</span>
                        <input type="text" name="demandeur_fin" value="{{ data.demandeur.fin }}" style="width:140px;padding:8px 10px;border:1px solid #e2e8f0;border-radius:6px;">
                        <button class="btn" name="action" value="update_demandeur">Modifier</button>
                    </form>

                    <form method="post" style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
                        <input type="hidden" name="numero_demande" value="{{ numeroDemande }}">
                        <span>Codemandeur :</span>
                        <input type="text" name="codemandeur_tiers" value="{{ data.codemandeur.tiers }}" placeholder="Tiers" style="width:120px;padding:8px 10px;border:1px solid #e2e8f0;border-radius:6px;">
                        <span>Date Début</span>
                        <input type="text" name="codemandeur_debut" value="{{ data.codemandeur.debut }}" style="width:140px;padding:8px 10px;border:1px solid #e2e8f0;border-radius:6px;">
                        <span>Date Fin</span>
                        <input type="text" name="codemandeur_fin" value="{{ data.codemandeur.fin }}" style="width:140px;padding:8px 10px;border:1px solid #e2e8f0;border-radius:6px;">
                        <button class="btn" name="action" value="update_codemandeur">Modifier</button>
                        <button class="btn btn-danger" name="action" value="delete_codemandeur">Supprimer</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}


